<div class="package-list-container">
  <header class="page-header">
    <button class="back-btn" routerLink="/dashboard">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="20" height="20">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
      </svg>
    </button>
    <h1>Packages</h1>
    <a routerLink="/packages/create" class="add-btn">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="20" height="20">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
      </svg>
    </a>
  </header>

  <main class="content">
    <!-- Search and Filters -->
    <div class="filters-section">
      <div class="search-box">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="18" height="18">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
        </svg>
        <input
          type="text"
          placeholder="Search by reference or email..."
          [(ngModel)]="searchQuery"
          (ngModelChange)="onSearchChange()"
        />
        @if (searchQuery) {
          <button class="clear-btn" (click)="searchQuery = ''; onSearchChange()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="16" height="16">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        }
      </div>

      <div class="status-filters">
        @for (status of statusOptions; track status) {
          <button
            class="filter-chip"
            [class.active]="statusFilter === status"
            (click)="statusFilter = status; onStatusFilterChange()"
          >
            {{ getStatusLabel(status) }}
            <span class="count">{{ getPackageCount(status) }}</span>
          </button>
        }
      </div>
    </div>

    <!-- Loading State -->
    @if (isLoading()) {
      <div class="loading-state">
        <div class="spinner"></div>
        <p>Loading packages...</p>
      </div>
    }

    <!-- Error State -->
    @else if (errorMessage()) {
      <div class="error-state">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="32" height="32">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
        </svg>
        <p>{{ errorMessage() }}</p>
        <button class="btn btn-primary" (click)="refresh()">Try Again</button>
      </div>
    }

    <!-- Empty State -->
    @else if (filteredPackages().length === 0) {
      <div class="empty-state">
        <div class="empty-icon">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5m6 4.125l2.25 2.25m0 0l2.25 2.25M12 13.875l2.25-2.25M12 13.875l-2.25 2.25M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" />
          </svg>
        </div>
        @if (searchQuery || statusFilter !== 'all') {
          <h3>No packages found</h3>
          <p>Try adjusting your search or filters</p>
          <button class="btn btn-secondary" (click)="searchQuery = ''; statusFilter = 'all'; applyFilters()">
            Clear Filters
          </button>
        } @else {
          <h3>No packages yet</h3>
          <p>Create your first package to get started</p>
          <a routerLink="/packages/create" class="btn btn-primary">
            Create Package
          </a>
        }
      </div>
    }

    <!-- Package List -->
    @else {
      <div class="package-list">
        @for (pkg of filteredPackages(); track pkg.id) {
          <div class="package-card" [routerLink]="['/packages', pkg.id]">
            <div class="package-header">
              <span class="reference">{{ pkg.reference }}</span>
              <span class="status-badge" [style.background-color]="getStatusColor(pkg.status)">
                {{ statusConfig[pkg.status].label }}
              </span>
            </div>
            <div class="package-body">
              <div class="receiver">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
                </svg>
                <span>{{ pkg.receiver_email }}</span>
              </div>
              @if (pkg.notes) {
                <p class="notes">{{ pkg.notes }}</p>
              }
            </div>
            <div class="package-footer">
              <span class="date">{{ formatDate(pkg.created_at) }}</span>
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="16" height="16" class="chevron">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
              </svg>
            </div>
          </div>
        }
      </div>

      <!-- Results Summary -->
      <p class="results-summary">
        Showing {{ filteredPackages().length }} of {{ packages().length }} packages
      </p>
    }
  </main>
</div>
